self.onmessage=function(M){var A="";var I={isMandatory:function(e,f){var a=false;if(e!==""){if(e==="1"||e==="y"||e==="yes"||e==="true"){if(f){f=f.trim()}if(f===""||f.length<1){a=false;A+="\nvalue cannot be empty";return}else{a=true}}else{a=true}}else{a=true}return a},isValidEmpId:function(a,e){},isMinValue:function(e,f){var a=false;if(e!==""){if(Number(f)<Number(e)){a=false;A+="\nvalue cannot be less than "+e;return}else{a=true}}else{a=true}return a},isValidEmail:function(e){var a=false;if(e!=""){if(!e.match(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/gi)){a=false;A+="\n Enter valid e-mail";return}else{a=true}}else{a=true}return a},isValidDateTime:function(e){var a=false;if(e!=""){e=e.replace(/\s\s+/g," ");if(!e.match(/^(0[1-9]|[12][0-9]|3[01])\/(0[1-9]|1[012])\/\d{4} ([01]\d|2[0-3]):[0-5]\d$/)){a=false;A+="\n Enter in dd/mm/yyyy hh:mm";return}else{a=true}}else{a=true}return a},isValidTimeStamp:function(e){var a=false;if(e!=""){e=e.replace(/\s\s+/g,"");if(!e.match(/^([01]\d|2[0-3]):[0-5]\d$/)){a=false;A+="\n Enter hh:mm";return}else{a=true}}else{a=true}return a},isMaxValue:function(e,f){var a=false;if(e!==""){if(Number(f)>Number(e)){a=false;A+="\nvalue cannot be greater than "+e;return}else{a=true}}else{a=true}return a},isMinLength:function(e,f){var a=false;if(e!==""){if(f&&(f.length<Number(e))){a=false;A+="\nvalue length cannot be less than "+e;return}else{a=true}}else{a=true}return a},isMaxLength:function(e,f){var a=false;if(e!==""){if(f&&(f.length>Number(e))){a=false;A+="\nvalue length cannot be greater than "+e;return}else{a=true}}else{a=true}return a},isBoolean:function(e,f){var a=false;if(e==="1"||e==="y"||e==="yes"||e==="true"){if(f==="1"||f==="y"||f==="yes"||f==="true"){a=true}else{a=false;A+="\nvalue should be only a boolean value";return}}else{a=true}return a},isFormatValid:function(f){var a=false;var e=new Date(f);if(e=="Invalid Date"){a=false;A+="\nDate is not in proper format"}else{a=true}}};function D(h,e){var a=false;var S=false;A="";switch(h.datatype.toLowerCase()){case"number":case"int":for(var Q in h){switch(Q.toLowerCase()){case"mandatoryflag":a=I.isMandatory(h[Q.toLowerCase()].trim(),e);if(a){if(e.split("^^").length>1){e=e.trim();e=parseFloat(e.split("^^").join(""))}else{}if(isNaN(e)){a=false;A+="\n value must be in number"}else{a=true}return a}else{return a}break;case"minvalue":a=I.isMinValue(h[Q].trim(),e);if(a){}else{return a}break;case"maxvalue":a=I.isMaxValue(h[Q].trim(),e);if(a){}else{return a}break;case"minlength":a=I.isMinLength(h[Q].trim(),e);if(a){}else{return a}break;case"maxlength":a=I.isMaxLength(h[Q].trim(),e);if(a){}else{return a}break;default:break}}return a;break;case"email":for(var Q in h){switch(Q.toLowerCase()){case"mandatoryflag":a=I.isMandatory(h[Q.toLowerCase()].trim(),e);if(a){a=I.isValidEmail(e);if(a){}else{return a}}else{return a}break}}return a;break;case"altitude":for(var Q in h){switch(Q.toLowerCase()){case"mandatoryflag":a=I.isMandatory(h[Q.toLowerCase()].trim(),e);if(a){if(e){if(!e.match(/^\d{3}.\d{6}$/)){a=false;A+="\n value is not in proper format(*3 digits(.)6 digits)"}else{a=true}}}else{return a}break}}return a;break;case"lname":for(var Q in h){switch(Q.toLowerCase()){case"mandatoryflag":a=I.isMandatory(h[Q.toLowerCase()].trim(),e);if(a){if(e){if(!e.trim().match(/^[a-zA-Z]*[ ]{0,1}[.]{0,1}[a-zA-Z]*[.]{0,1}$/gi)){a=false;A+="\n value is not in proper format(only alphabets with *single space and *(.))"}else{a=true}}}else{return a}break}}return a;break;case"fname":for(var Q in h){switch(Q.toLowerCase()){case"mandatoryflag":a=I.isMandatory(h[Q.toLowerCase()].trim(),e);if(a){if(e){if(!e.trim().match(/^[a-zA-Z]*[ ]{0,1}[a-zA-Z]*$/gi)){a=false;A+="\n value is not in proper format(only alphabets with *single space)"}else{a=true}}}else{return a}break}}return a;break;case"latlng":for(var Q in h){switch(Q.toLowerCase()){case"mandatoryflag":a=I.isMandatory(h[Q.toLowerCase()].trim(),e);if(a){if(e){if(!e.match(/^\d{2}.\d{6}$/)){a=false;A+="\n value is not in proper format(*2 digits(.)6 digits)"}else{a=true}}}else{return a}break}}return a;break;case"emp_id":for(var Q in h){switch(Q.toLowerCase()){case"mandatoryflag":a=I.isMandatory(h[Q.toLowerCase()].trim(),e);if(a){if(e){if(!e.match(/^[0-9]{5}[a-zA-z]{3}$/)){a=false;A+="\n value is not in proper format(*5 digits and 3 characters)"}else{a=true}}}else{return a}break}}return a;break;case"varchar2":case"string":case"varchar":for(var Q in h){switch(Q.toLowerCase()){case"mandatoryflag":a=I.isMandatory(h[Q.toLowerCase()].trim(),e);if(a){}else{return a}break;case"minlength":a=I.isMinLength(h[Q].trim(),e.trim());if(a){}else{return a}break;case"maxlength":a=I.isMaxLength(h[Q].trim(),e.trim());if(a){}else{return a}break;default:break}}return a;break;case"mobile":for(var Q in h){switch(Q.toLowerCase()){case"mandatoryflag":a=I.isMandatory(h[Q.toLowerCase()].trim(),e);if(a&&e!==""){if(isNaN(e)){a=false;A+="\n value must be in number"}else{a=true;var P=/^[7-9]{1}[0-9]*$/;if(!e.match(P)){a=false;A+="\n value must start with 7 or 8 or9"}else{a=true}}}else{return a}return a;break;case"minlength":a=I.isMinLength(h[Q].trim(),e);if(a){}else{return a}break;case"maxlength":a=I.isMaxLength(h[Q].trim(),e);if(a){}else{return a}break;default:break}}break;case"alphanumeric":for(var Q in h){switch(Q.toLowerCase()){case"mandatoryflag":a=I.isMandatory(h[Q.toLowerCase()].trim(),e);if(a&&e!==""){a=false;var f=/^[0-9a-zA-Z]+$/;if(!e.match(f)){a=false;A+="\n value must be alphanumeric"}else{a=true}}else{return a}return a;break;case"minlength":a=I.isMinLength(h[Q].trim(),e);if(a){}else{return a}break;case"maxlength":a=I.isMaxLength(h[Q].trim(),e);if(a){}else{return a}break;default:break}}break;case"plainnumber":for(var Q in h){switch(Q.toLowerCase()){case"mandatoryflag":a=I.isMandatory(h[Q.toLowerCase()].trim(),e.trim());if(a&&e!==""){a=false;var f=/^[0-9]+$/;e=e.trim();if(!e.match(f)){a=false;A+="\n value must be numeric without any special characters"}else{a=true}}else{return a}return a;break;case"minlength":a=I.isMinLength(h[Q].trim(),e.trim());if(a){}else{return a}break;case"maxlength":a=I.isMaxLength(h[Q].trim(),e.trim());if(a){}else{return a}break;default:break}}break;case"alpha":for(var Q in h){switch(Q.toLowerCase()){case"mandatoryflag":a=I.isMandatory(h[Q.toLowerCase()].trim(),e.trim());if(a&&e!==""){a=false;var f=/^[a-zA-Z\s]+$/;e=e.trim();if(!e.match(f)){a=false;A+="\n value must be alphabet"}else{a=true}}else{return a}return a;break;case"minlength":a=I.isMinLength(h[Q].trim(),e.trim());if(a){}else{return a}break;case"maxlength":a=I.isMaxLength(h[Q].trim(),e.trim());if(a){}else{return a}break;default:break}}break;case"boolean":for(var Q in h){switch(Q.toLowerCase()){case"mandatoryflag":a=I.isMandatory(h[Q.toLowerCase()],e);if(a){a=I.isBoolean(h[Q].trim().toLowerCase(),e.toLowerCase());if(a){}else{return a}}else{return a}break;default:break}}return a;break;case"time":for(var Q in h){switch(Q.toLowerCase()){case"mandatoryflag":a=I.isMandatory(h[Q.toLowerCase()],e);if(a){a=I.isValidTimeStamp(e);if(a){}else{return a}}else{return a}break;default:break}}return a;break;case"datetime":for(var Q in h){switch(Q.toLowerCase()){case"mandatoryflag":a=I.isMandatory(h[Q.toLowerCase()],e);if(a){a=I.isValidDateTime(e);if(a){}else{return a}}else{return a}break;default:break}}return a;break;case"date":for(var Q in h){switch(Q.toLowerCase()){case"mandatoryflag":a=I.isMandatory(h[Q.toLowerCase()].trim(),e);if(a&&e!==""){var R=/(0[1-9]|[12][0-9]|3[01])\/(0[1-9]|1[012])\/\d{4}$/;if(!e.match(R)){a=false;A+="\n Date must be in format dd/mm/yyyy"}else{a=true}return a}else{return a}break}}break;case"timestamp":a=true;return a;break;default:break}}var k=[];var j=M.data.key1;j=j.trim();var u=M.data.key2;var G=M.data.key3;var p=M.data.key4||[];var d=M.data.key5.toLowerCase();var t=M.data.key6||[];var O=M.data.key7||[];var g=j.split("\n");var y=g[0].toLowerCase().split(",");y=y.map(Function.prototype.call,String.prototype.trim);var z=y.indexOf("");if(z>-1){y=y.splice(0,z)}var l="";switch(d){case"create mapping":case"change mapping":if(y.length===u.length){if(g.length===1){postMessage({type:"headers",data:y,message:""})}else{l="Selected File Should only contain column headers";postMessage({type:"error",data:false,message:l})}}else{l="Number of columns in the file do not match template columns";postMessage({type:"error",data:false,message:l})}break;case"upload data":for(var v=0,E=p.length;v<E;v++){p[v]["isvalid"]="Staging Data"}for(var F=0,c=t.length;F<c;F++){t[F]["isvalid"]="Rejected Data"}for(var q=0,s=O.length;q<s;q++){O[q]["isvalid"]="Master Data"}if(G.length>0){G=G.join(",").toLowerCase().split(",")}else{postMessage({type:"headers",data:y,message:""})}var K={};for(var J=0,w=G.length;J<w;J++){var b=y.indexOf(G[J].toLowerCase().trim());if(b>-1){K[G[J]]=b}else{postMessage({type:"headers",data:y,message:""});postMessage({type:"error",data:false,message:"Column Names donot match"});return}}var i=G;i.push("isvalid");var B=i.join("~");if(g.length===1){postMessage({type:"headers",data:y,message:""});postMessage({type:"error",data:false,message:"No data found, select other sheet or file"})}else{if(g.length>1&&y.length===u.length){try{var n;var H="";for(var L=1,w=g.length;L<w;L++){var r={};var m=g[L].split(",");var C=true;n="valid";H={};var x=[];for(var N=0,o=u.length;N<o;N++){if(m[K[G[N]]]){C=false}m[K[G[N]]]=m[K[G[N]]].replace(/"/g,"");x.push([u[N]["attributeid"]]);if(D(u[N],m[K[G[N]]].trim())){}else{n="invalid";H[G[N]]=A}m[K[G[N]]]=m[K[G[N]]].trim();r[G[N]]=m[K[G[N]]].replace(/\^\^/g,",");A=""}r.attributeid=x.join("~");r.heading=B;r.isvalid=n;r.invalidReason=H;if(!C){k.push(r)}}}catch(M){}postMessage({type:"headers",data:G,message:""});k=k.concat(p);k=k.concat(t);k=k.concat(O);postMessage({type:"tabledata",data:k})}else{postMessage({type:"error",data:false,message:"Number of columns in the file do not match template columns"})}}break;default:break}};