var domainUrl="https://lms.janalakshmi.com/";var pwcProperties={platwareURL:"http://decsit.decimaltech.net/PlatwareAnalyzer_02_02_00/PWSURLJson",platwareRequest:{PWSESSIONRS:{PWPROCESSRS:{PWHEADER:{ORG_ID:"MDM",IN_PROCESS_ID:"",OUT_PROCESS_ID:"",USER_ID:"PORTAL",PASSWORD:"",USER_SESSION_ID:"",APP_ID:"MDM",VERSION_ID:"",IMEI_NO:"",OS_VERSION:"",DEVICE_MAKE:"",DEVICE_MODEL:"",SIM_ID:"",SERVER_TIMESTAMP:"",DEVICE_TIMESTAMP:"",DEVICE_LATITUDE:"",DEVICE_LONGITUDE:"",LOCATION:"",PW_SESSION_ID:"",LOGIN_ID:"",PW_VERSION:"",PW_CLIENT_VERSION:"",SESSION_EXPIRE_TIME:"",INSTALLATION_ID:""},PWDATA:{},PWERROR:""}}},tableName:"pwcProperties",lastPlatwareSessionId:"",platwareVersion:"",pwcVersion:"",model:"",platform:"",osVersion:"",installLong:"",installLat:"",installSimId:"",currentSimId:"",make:"",IEMI:"",phoneNumber:"",URL:domainUrl+"pwjfs/GatewayAnalyserJson?ORG_ID=MDM",encURL:domainUrl+"PlatwareAnalyserIndusInd/GatewayAnalyserEncrypt?ORG_ID=MDM",encURLRR:domainUrl+"PlatwareAnalyserOracle_01/GatewayAnalyserEncryptRR?ORG_ID=MDM",ORGID:"KOTLMS",Id:"KOTLMS",authenticated:"",status:"",userId:"",password:"",installTS:"",installationId:"",version:"",versionOnServer:"",versionUpgradeAvailable:"",versionUpdateURL:"",versionUpdateMandatory:false,orgConfigLoaded:"",checkTableDefOC:"Y",pushNotificationId:"",pushNotificationAppId:"",pushNotificationPreference:"",changeUser:"",changeUserOnOrgApp:"",loginIdPrevious:"",passwordPrevious:"",lastUseTS:"",lastUserSessionId:"",lastAuthTS:"",checkLastSyncDate:"",insertInPendingQueue:"",sessionId:"",sessionExpirable:"",SessionExpirationTS:"",lastServerConnectTS:"",lastServerConnectSuccessTS:"",lockCode:"",lockCodeAttempts:"",lockCodeType:"",checkFirstRun:false,startTime:new Object(),startPosition:new Object(),dataColumns:[{name:"platwareURL",datatype:"text",},{name:"lastPlatwareSessionId"},{name:"platwareVersion"},{name:"pwcVersion"},{name:"make",datatype:"text"},{name:"model",datatype:"text"},{name:"platform",datatype:"text"},{name:"osVersion",datatype:""},{name:"installLat",datatype:"text"},{name:"installLong",datatype:"text"},{name:"installSimId",datatype:"text",},{name:"currentSimId",datatype:"text"},{name:"IEMI",datatype:"text"},{name:"phoneNumber",datatype:"integer"},{name:"tableId",datatype:"text"},{name:"URL",datatype:"text"},{name:"ORGID",datatype:"text"},{name:"app_id",datatype:"text"},{name:"authenticated",datatype:"text"},{name:"status",datatype:"text"},{name:"userId",datatype:"text"},{name:"password",datatype:"text"},{name:"installTS",datatype:"text"},{name:"installationId",datatype:"text"},{name:"version",datatype:"text"},{name:"versionOnServer",datatype:"text"},{name:"versionUpgradeAvailable",datatype:"text"},{name:"versionUpdateURL",datatype:"text"},{name:"versionUpdateMandatory",datatype:"text"},{name:"orgConfigLoaded",datatype:""},{name:"checkTableDefOC",datatype:"text"},{name:"pushNotificationId",datatype:"text"},{name:"pushNotificationAppId",datatype:"text"},{name:"pushNotificationPreference",datatype:"text"},{name:"changeUser",datatype:"text"},{name:"changeUserOnOrgApp",datatype:"text"},{name:"loginIdPrevious",datatype:"text"},{name:"passwordPrevious",datatype:"text"},{name:"lastUseTS",datatype:"text"},{name:"lastUserSessionId",datatype:"text"},{name:"lastAuthTS",datatype:"text"},{name:"sessionId",datatype:"text"},{name:"sessionExpirable",datatype:"text"},{name:"SessionExpirationTS",datatype:"text"},{name:"lastServerConnectTS",datatype:"text"},{name:"lastServerConnectSuccessTS",datatype:"text"},{name:"lockCode",datatype:"text"},{name:"lockCodeAttempts",datatype:"text"},{name:"lockCodeType",datatype:"text"},{name:"insertInPendingQueue",datatype:"text"},{name:"checkLastSyncDate",datatype:"text"}]};var PlatwareDb={DbName:"platwareClient",DbObj:"",tables:new Object(),DbRequestObj:new Object()};var pwcMethods={initSuccessCallback:null,initErrorCallback:null,initialise:function(a,i,d,h,c,g,b){console.time("initTime");pwcProperties.startTime=new Date();try{pwcMethods.initSuccessCallback=g;pwcMethods.initErrorCallback=b}catch(f){alert(JSON.stringify(f))}if(this.checkId(i)&&this.checkId(d)){pwcProperties.ORGID=i;pwcProperties.Id=d;DbMethods.openDb(PlatwareDb.DbName,function(e){PlatwareDb.DbObj=e;pwcMethods.checkPWCproperties(pwcMethods.getPWCproperties,pwcMethods.createPWCpropertiesTable)},function(e){console.log(e)})}else{console.log("ORGID or APPID missing")}if(this.checkId(h)&&this.checkId(c)){pwcProperties.userId=h;pwcProperties.password=c}else{console.log("username or password missing")}},createPWCpropertiesTable:function(){DbMethods.createTable(PlatwareDb.DbObj,pwcProperties.tableName,pwcProperties.dataColumns,function(){pwcMethods.resetPWCproperties(pwcMethods.getAppURL,function(){alert("1")})},function(){alert("error while creating pwc properties table")})},checkPWCproperties:function(a,b){var c=PlatwareDb.DbObj;DbMethods.checkTable(c,pwcProperties.tableName,function(){a(pwcMethods.checkPWCdata,pwcMethods.resetPWCproperties)},b)},getPWCproperties:function(a,b){DbMethods.readData(PlatwareDb.DbObj,pwcProperties.tableName,["*"],[{name:"ORGID",operator:"=",value:pwcProperties.ORGID}],{},function(e){if(e.length>0){var f=e[0];var d=Object.keys(f);for(var c=0;c<d.length;c++){pwcProperties[d[c]]=f[d[c]]}a()}else{b(pwcMethods.getAppURL,pwcMethods.platwareDataTableError)}},b)},resetPWCproperties:function(b,c,f){pwcProperties.installTS=PWCutilities.toTimestamp(pwcProperties.startTime);var d=pwcProperties.tableName;var e=PWCutilities.getDeviceInfo();pwcProperties.platform=e.platform;pwcProperties.model=e.model;pwcProperties.osVersion=e.osVersion;pwcProperties.make=e.make;console.log(pwcProperties.ORGID);var g=[{platwareURL:pwcProperties.platwareURL,lastPlatwareSessionId:"",platwareVersion:3.2,pwcVersion:0.53,model:pwcProperties.model,osVersion:pwcProperties.osVersion,platform:pwcProperties.platform,make:pwcProperties.make,URL:pwcProperties.URL,app_id:pwcProperties.Id,ORGID:pwcProperties.ORGID,authenticated:pwcProperties.authenticated,status:pwcProperties.status,userId:pwcProperties.userId,password:pwcProperties.password,installTS:pwcProperties.installTS,installationId:pwcProperties.installationId,version:pwcProperties.version,versionOnServer:pwcProperties.versionOnServer,versionUpgradeAvailable:pwcProperties.versionUpgradeAvailable,versionUpdateURL:pwcProperties.versionUpdateURL,versionUpdateMandatory:pwcProperties.versionUpdateMandatory,orgConfigLoaded:pwcProperties.orgConfigLoaded,checkTableDefOC:pwcProperties.checkTableDefOC,pushNotificationId:pwcProperties.pushNotificationId,pushNotificationAppId:pwcProperties.pushNotificationAppId,pushNotificationPreference:pwcProperties.pushNotificationPreference,changeUser:pwcProperties.changeUser,changeUserOnOrgApp:pwcProperties.changeUserOnOrgApp,loginIdPrevious:pwcProperties.loginIdPrevious,passwordPrevious:pwcProperties.passwordPrevious,lastUseTS:pwcProperties.lastUseTS,lastUserSessionId:pwcProperties.lastUserSessionId,lastAuthTS:pwcProperties.lastAuthTS,sessionId:pwcProperties.sessionId,sessionExpirable:pwcProperties.sessionExpirable,lastServerConnectTS:pwcProperties.lastServerConnectTS,lastServerConnectSuccessTS:pwcProperties.lastServerConnectSuccessTS,lockCode:pwcProperties.lockCode,lockCodeAttempts:pwcProperties.lockCodeAttempts,lockCodeType:pwcProperties.lockCodeType,insertInPendingQueue:pwcProperties.insertInPendingQueue,checkLastSyncDate:pwcProperties.checkLastSyncDate}];var a;f?a=function(){b()}:a=function(){b(pwcMethods.getInstallId,pwcMethods.URLGetError)};PWCutilities.orgDataChecker(d,g,a,c)},createPlatwareTable:function(a){console.log("starttime:"+pwcProperties.installTS);DbMethods.createTable(PlatwareDb.DbObj,a,Platware.dataColumns,pwcMethods.savePlatwareDataTable,pwcMethods.platwareCreateTableError)},checkDeviceTable:function(a,b){console.log("platware info table setup complete.");DbMethods.checkTable(PlatwareDb.DbObj,thisDevice.tableName,function(c){a(pwcMethods.checkAppTable,pwcMethods.saveDeviceTable)},b)},savePlatwareDataTable:function(a,b){pwcProperties.installTS=PWCutilities.toTimestamp(pwcProperties.startTime);var c=b||pwcProperties.tableName;var d=PWCutilities.getDeviceInfo();thisDevice.platform=d.platform;thisDevice.model=d.model;thisDevice.osVersion=d.osVersion;thisDevice.make=d.make;console.log(pwcProperties.ORGID);var e=[{platwareURL:pwcProperties.platwareURL,lastPlatwareSessionId:"",platwareVersion:3.2,pwcVersion:0.53,model:thisDevice.model,osVersion:thisDevice.osVersion,platform:thisDevice.platform,make:thisDevice.make}];PWCutilities.orgDataChecker(c,e,pwcMethods.createDeviceTable,pwcMethods.platwareDataTableError)},platwareCreateTableError:function(a){console.log("Error while creating platware database.\n Stopping the application.\nError message:\n"+a)},getPlatwareData:function(a,b){DbMethods.readData(PlatwareDb.DbObj,Platware.tableName,["*"],[{name:"ORGID",operator:"=",value:application.ORGID}],{},function(e){if(e.length>0){var f=e[0];var d=Object.keys(f);for(var c=0;c<d.length;c++){Platware[d[c]]=f[d[c]]}a(pwcMethods.getDeviceData,pwcMethods.createDeviceTable)}else{b()}},b)},getDeviceData:function(a,b){DbMethods.readData(PlatwareDb.DbObj,thisDevice.tableName,["*"],[{name:"ORGID",operator:"=",value:pwcProperties.ORGID}],{},function(e){if(e.length>0){var f=e[0];var d=Object.keys(f);for(var c=0;c<d.length;c++){thisDevice[d[c]]=f[d[c]]}a(pwcMethods.getAppData,pwcMethods.createAppTable)}else{b()}},b)},createDeviceTable:function(){DbMethods.checkTable(PlatwareDb.DbObj,thisDevice.tableName,function(){pwcMethods.getDeviceData(pwcMethods.checkAppTable,pwcMethods.saveDeviceTable)},function(){DbMethods.createTable(PlatwareDb.DbObj,thisDevice.tableName,thisDevice.dataColumns,pwcMethods.saveDeviceTable,pwcMethods.deviceTableError)});console.log("data inserted in platware table")},platwareDataTableError:function(a){console.log("err:"+a)},deviceTableError:function(a){console.log(a)},checkAppTable:function(a,b){console.log("device info table setup complete");DbMethods.checkTable(PlatwareDb.DbObj,application.tableName,function(c,d){a(pwcMethods.checkPWCdata,pwcMethods.getAppURL)},b)},saveDeviceTable:function(){console.log("device table created");var a="";try{var d=PWCutilities.getDeviceInfo();console.log("-->"+JSON.stringify(d));thisDevice.platform=d.platform;thisDevice.model=d.model;thisDevice.osVersion=d.osVersion;thisDevice.make=d.make;var c=[{model:thisDevice.model,osVersion:thisDevice.osVersion,platform:thisDevice.platform,make:thisDevice.make}]}catch(b){console.log(b.message)}PWCutilities.orgDataChecker(thisDevice.tableName,c,pwcMethods.createAppTable,pwcMethods.deviceDataTableError)},createAppTable:function(){DbMethods.checkTable(PlatwareDb.DbObj,application.tableName,function(){pwcMethods.getAppData(pwcMethods.checkPWCdata,function(){pwcMethods.getAppURL(application.ORGID,application.Id,pwcMethods.getInstallId,pwcMethods.URLGetError)})},function(){DbMethods.createTable(PlatwareDb.DbObj,application.tableName,application.dataColumns,function(a,b){pwcMethods.getAppURL(pwcMethods.getInstallId,pwcMethods.URLGetError)},pwcMethods.appTableError)})},deviceDataTableError:function(){alert("heh")},getAppData:function(b,c){var a=PlatwareDb.DbObj;DbMethods.readData(a,application.tableName,["*"],[{name:"ORGID",operator:"=",value:application.ORGID}],{},function(f){if(f.length>0){var g=f[0];var e=Object.keys(application);for(var d=0;d<e.length;d++){application[e[d]]=g[e[d]]}b()}else{c(pwcMethods.getInstallId,pwcMethods.URLGetError)}})},saveAppTable:function(){var a=[{name:"URL",value:"text"},{name:"id",value:"text"},{name:"ORGID",value:"text"},{name:"authenticated",value:"text"},{name:"status",value:"text"},{name:"userId",value:"text"},{name:"password",value:"text"},{name:"installTS",value:"text"},{name:"version",value:"text"},{name:"versionOnServer",value:"text"},{name:"versionUpgradeAvailable",value:"text"},{name:"versionUpdateURL",value:"text"},{name:"versionUpdateMandatory",value:"text"},{name:"orgConfigLoaded",value:""},{name:"pwcConfigLoaded",value:"text"},{name:"pushNotificationId",value:"text"},{name:"pushNotificationAppId",value:"text"},{name:"pushNotificationPreference",value:"text"},{name:"changeUser",value:"text"},{name:"changeUserOnOrgApp",value:"text"},{name:"loginIdPrevious",value:"text"},{name:"passwordPrevious",value:"text"},{name:"lastUseTS",value:"text"},{name:"lastUserSessionId",value:"text"},{name:"lastAuthTS",value:"text"},{name:"sessionId",value:"text"},{name:"sessionExpirable",value:"text"},{name:"SessionExpirationTS",value:"text"},{name:"lastServerConnectTS",value:"text"},{name:"lastServerConnectSuccessTS",value:"text"},{name:"lockCode",value:"text"},{name:"lockCodeAttempts",value:"text"},{name:"lockCodeType",value:"text"},{name:"insertInPendingQueue",value:"text"},{name:"checkLastSyncDate",value:"text"},]},appTableError:function(){},getAppURL:function(a,b){var c="http://128.136.227.190/PlatwareAnalyzer_03_02_00/GatewayAnalyserJson?ORG_ID=";pwcMethods.setAppURL(c);a(pwcMethods.getORGConfig,pwcMethods.installIdError)},checkId:function(b){var a=false;if(b){if(b.length>0){a=true}}return a},setAppURL:function(a){pwcProperties.URL=a},getInstallId:function(b,d){alert("getting install id");var a=pwcProperties.ORGID;var e=pwcProperties.Id;var f=pwcProperties.URL+a;pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWHEADER.ORG_ID=a;pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWHEADER.APP_ID=e;pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWHEADER.LOGIN_ID=pwcProperties.userId;pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWHEADER.PASSWORD=pwcProperties.password;var c=[{processName:"PWAPPINSTALL",data:[{org_id:a,app_id:e,platform:pwcProperties.platform,install_time:pwcProperties.installTS}]},];PWCutilities.callPlatware(f,c,function(j,g,k){var i=PWCutilities.getResponseRowData(j.PWSESSIONRS[0]);var h=i[0].installation_id;pwcMethods.setInstallId(h);return b(pwcMethods.saveOrgConfig,pwcMethods.orgConfigError)},d)},installIdError:function(b,a,c){console.log(JSON.stringify(b))},setInstallId:function(a){pwcProperties.installationId=a;pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWHEADER.INSTALLATION_ID=a},getORGConfig:function(a,c){var b=pwcProperties.ORGID;var e=pwcProperties.Id;var d=[{processName:"PWORGCONFIG",data:[{org_id:b,app_id:e}]}];PWCutilities.callPlatware(pwcProperties.URL+b,d,function(h,f,i){var g=PWCutilities.getResponseRowData(h.PWSESSIONRS[0]);a(g,pwcMethods.Authentication,pwcMethods.orgConfigSaveError)},c)},saveOrgConfig:function(c,a,b){PWCutilities.orgDataChecker("configuration",c,function(){pwcProperties.orgConfigLoaded="Y";return a(pwcMethods.checkVersion,pwcMethods.AuthenticationError)},function(){return b()})},orgConfigError:function(b,a,c){console.log("errr:\n"+JSON.stringify(b)+"\n"+a+"\n"+JSON.stringify(c))},orgConfigSaveError:function(a){console.log(a)},Authentication:function(a,b){var d=pwcProperties.lastAuthTS;console.log("username is : "+pwcProperties.userId+"\npassword is : "+pwcProperties.password);var c=[{processName:"PWAUTH",data:[{org_id:pwcProperties.ORGID,app_id:pwcProperties.Id}]}];pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWHEADER.LOGIN_ID=pwcProperties.userId;pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWHEADER.PASSWORD=pwcProperties.password;PWCutilities.callPlatware(pwcProperties.URL+pwcProperties.ORGID,c,function(f){var e=PWCutilities.getResponseRowData(f.PWSESSIONRS[0]);if(e[0].is_auth=="Y"||e[0].is_auth=="YES"||e[0].is_auth=="Yes"){pwcProperties.lastAuthTS=PWCutilities.toTimestamp(new Date());PWCutilities.saveLastAuthTS(d);console.log("authenticated");pwcProperties.authenticated=e[0].is_auth;a(pwcMethods.saveLocalData,pwcMethods.checkVersionError)}else{b()}},function(e){b()})},saveLocalData:function(a,b){var d=PlatwareDb.DbObj;var c=[{URL:application.URL,app_id:application.Id,ORGID:application.ORGID,authenticated:application.authenticated,status:application.status,userId:application.userId,password:application.password,installTS:application.installTS,installationId:application.installationId,version:application.version,versionOnServer:application.versionOnServer,versionUpgradeAvailable:application.versionUpgradeAvailable,versionUpdateURL:application.versionUpdateURL,versionUpdateMandatory:application.versionUpdateMandatory,orgConfigLoaded:application.orgConfigLoaded,checkTableDefOC:application.checkTableDefOC,pushNotificationId:application.pushNotificationId,pushNotificationAppId:application.pushNotificationAppId,pushNotificationPreference:application.pushNotificationPreference,changeUser:application.changeUser,changeUserOnOrgApp:application.changeUserOnOrgApp,loginIdPrevious:application.loginIdPrevious,passwordPrevious:application.passwordPrevious,lastUseTS:application.lastUseTS,lastUserSessionId:application.lastUserSessionId,lastAuthTS:application.lastAuthTS,sessionId:application.sessionId,sessionExpirable:application.sessionExpirable,lastServerConnectTS:application.lastServerConnectTS,lastServerConnectSuccessTS:application.lastServerConnectSuccessTS,lockCode:application.lockCode,lockCodeAttempts:application.lockCodeAttempts,lockCodeType:application.lockCodeType,insertInPendingQueue:application.insertInPendingQueue,checkLastSyncDate:application.checkLastSyncDate}];PWCutilities.orgDataChecker(application.tableName,c,function(){},function(){});a(function(){alert("success");pwcMethods.initSuccessCallback()},function(){alert("err");pwcMethods.initErrorCallback()})},checkVersion:function(a,b){console.log("checking version");pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWHEADER.VERSION_ID="1.0";var c=[{processName:"PWCHKV",data:[{org_id:pwcProperties.ORGID,app_id:pwcProperties.Id,platform:pwcProperties.platform,}]}];pwcProperties.versionOnServer="";pwcProperties.versionUpgradeAvailable="";if(pwcProperties.versionUpgradeAvailable=="Y"||pwcProperties.versionUpgradeAvailable=="y"||pwcProperties.versionUpgradeAvailable=="YES"||pwcProperties.versionUpgradeAvailable=="yes"){pwcProperties.versionUpdateMandatory=""}a(pwcMethods.GetProcessConfig,function(){})},checkVersionError:function(){},GetProcessConfig:function(b,d){console.log("getting proccess mapping");var c=PWCutilities.toTimestamp(new Date());var e={org_id:pwcProperties.ORGID,app_id:pwcProperties.Id,timestamp:c};var a=[{processName:"PWPROCESSCONFIGAS",data:[e]},{processName:"PWPROCESSCONFIGSA",data:[e]},{processName:"PWPROCESSPARAMAS",data:[e]},{processName:"PWPROCESSPARAMSA",data:[e]},{processName:"PWPROCESSCONFIGMAP",data:[e]},{processName:"PWPROCESSPARAMMAP",data:[e]}];PWCutilities.callPlatware(pwcProperties.URL+pwcProperties.ORGID,a,function(h){var g=h.PWSESSIONRS.length;var f=0;PWCutilities.orgDataChecker("process_master_as",PWCutilities.getResponseRowData(h.PWSESSIONRS[f]),function(){f++;PWCutilities.orgDataChecker("process_master_sa",PWCutilities.getResponseRowData(h.PWSESSIONRS[f]),function(){f++;PWCutilities.orgDataChecker("process_parameter_master_as",PWCutilities.getResponseRowData(h.PWSESSIONRS[f]),function(){f++;PWCutilities.orgDataChecker("process_parameter_master_sa",PWCutilities.getResponseRowData(h.PWSESSIONRS[f]),function(){f++;PWCutilities.orgDataChecker("process_table_mapping",PWCutilities.getResponseRowData(h.PWSESSIONRS[f]),function(){f++;PWCutilities.orgDataChecker("process_parameter_mapping",PWCutilities.getResponseRowData(h.PWSESSIONRS[f]),function(){pwcProperties.checkTableDefOC="Y";b()},d,["process_id","parameter_name"])},d,["process_id","table_name"])},d,["process_id","parameter_sequence","parameter_name"])},d,["process_id","parameter_sequence","parameter_name"])},d,["process_id"])},d,["process_id"])},function(f){alert(JSON.stringify(f))})},checkPWCdata:function(){if(pwcProperties.URL.length>0){if(pwcProperties.installationId!==""){pwcMethods.Authentication(function(){if(pwcProperties.orgConfigLoaded==="Y"){PWCutilities.checkParamCount("process_master_as","process_parameter_master_as",function(){PWCutilities.checkParamCount("process_master_sa","process_parameter_master_sa",function(){pwcMethods.initSuccessCallback()},function(){})},function(){alert("n1")})}else{alert("org config not loaded");pwcMethods.getORGConfig(pwcMethods.saveOrgConfig,pwcMethods.orgConfigError)}},function(){})}else{alert("install id not found");pwcMethods.getInstallId(pwcMethods.getORGConfig,pwcMethods.installIdError)}}else{alert("url not found");pwcMethods.getAppURL(pwcMethods.getInstallId,pwcMethods.URLGetError)}},AuthenticationError:function(a){alert("in auth error");alert(JSON.stringify(a))},submit:function(a,b){},URLGetError:function(a){console.log("Error while fetching APP URL\n"+a)},initializeWithLastLogin:function(){}};var PWCerrorHandlers={};var PWCutilities={createDataJSON:function(b){var d=b.length;var l=[];var j={};while(l.length<d){var h=[];var f=b[l.length].data;var c=f.length;if(c>0){h.length=0;for(var g=0;g<c;g++){var k={};for(var a in f[g]){k[a]=f[g][a]}h.push(k)}j[b[l.length].processName]={Row:h};l.push(b[l.length].processName)}else{j[b[l.length].processName]="";l.push(b[l.length].processName)}}pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWHEADER.OUT_PROCESS_ID=l.join("~");pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWDATA=j;pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWERROR="";var e='{"PWSESSIONRS":{"PWPROCESSRS":{"PWHEADER":'+JSON.stringify(pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWHEADER)+',"PWDATA":'+JSON.stringify(pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWDATA)+',"PWERROR":""}}}';e=e.trim();return e},createPWsessionId:function(){var d=new Date();var b="";var a=PWCutilities.toDoubleDigits(d.getMonth()+1);var c=d.getFullYear()+a+""+PWCutilities.toDoubleDigits(d.getDate())+""+PWCutilities.toDoubleDigits(d.getHours())+""+PWCutilities.toDoubleDigits(d.getMinutes())+""+PWCutilities.toDoubleDigits(d.getSeconds())+""+PWCutilities.toDoubleDigits(d.getMilliseconds());b=pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWHEADER.INSTALLATION_ID+""+c;return b},toTimestamp:function(d){var a="";switch(Object.prototype.toString.call(d)){case"[object String]":try{var e=new Date(d);if(e=="Invalid Date"){throw"Cannot convert to timestamp: Invalid date"}else{var c=PWCutilities.toDoubleDigits(e.getMonth()+1);a=e.getFullYear()+"-"+c+"-"+e.getDate()+" "+PWCutilities.toDoubleDigits(e.getHours())+":"+PWCutilities.toDoubleDigits(e.getMinutes())+":"+PWCutilities.toDoubleDigits(e.getSeconds())}}catch(b){console.log(b);return false}break;case"[object Date]":var e=d;var c=PWCutilities.toDoubleDigits(e.getMonth()+1);a=e.getFullYear()+"-"+c+"-"+e.getDate()+" "+PWCutilities.toDoubleDigits(e.getHours())+":"+PWCutilities.toDoubleDigits(e.getMinutes())+":"+PWCutilities.toDoubleDigits(e.getSeconds());break;default:console.log("Cannot convert to timestamp: Invalid date");return false;break}return a},toDoubleDigits:function(b){var a="";b<10?a="0"+b:a=b;return a},callPlatware:function(a,f,b,g,e,i,h){var c=PWCutilities.createDataJSON(f);var d=[];webService.ajaxCall(a,c,function(n,k,p){var l=JSON.parse(c);pwcProperties.lastPlatwareSessionId=l.PWSESSIONRS.PWPROCESSRS.PWHEADER.PW_SESSION_ID;n=JSON.parse(n);var o=n.PWSESSIONRS.length;for(var m=0;m<o;m++){if(n.PWSESSIONRS[m].PWPROCESSRS.PWERROR!==""){var j=n.PWSESSIONRS[m].PWPROCESSRS.PWHEADER.IN_PROCESS_ID;g(n.PWSESSIONRS[m].PWPROCESSRS.PWERROR[j]["Row"]["Message"],k,p,h);return}}b(n,k,p,h)},function(k,j,l){g(k,j,l,h)},e,i,h)},getResponseRowData:function(e){var e=e;var c=e.PWPROCESSRS.PWHEADER.IN_PROCESS_ID;var a=e.PWPROCESSRS.PWDATA;var d;try{if(a[c]){d=a[c].Row}else{throw"data not found for corresponding process name"}}catch(b){console.log(b)}return d},saveLastPlatwareSessionId:function(c){console.log("saving lastpwsid:   "+c);var a=PlatwareDb.DbObj;var b=[{name:"lastPlatwareSessionId",value:c}];DbMethods.updateData(a,"platwareData",b,[],function(){},function(){})},saveLastAuthTS:function(b){var a=PlatwareDb.DbObj;var c=[{name:"lastAuthTS",value:b}];DbMethods.updateData(a,pwcProperties.tableName,c,[{name:"tableId",operator:"=",value:"1"}],function(){},function(){})},orgDataChecker:function(j,e,d,f,h){if(e.length>0){var b=e;var a=b[0];var c=(Object.keys(a).toString()).split(",");var i=PlatwareDb.DbObj;DbMethods.checkTable(i,j,function(){DbMethods.readData(PlatwareDb.DbObj,j,["*"],{},{name:"tableId",ordering:"ASC"},function(q){var p=q.length;console.log(j+" with rows : "+p);switch(p){case 0:case"0":l(j,"1");break;case 1:case"1":if(q[0]["ORGID"]===pwcProperties.ORGID){if(q[0]["app_id"]===pwcProperties.Id){g(j,"1")}else{var m=[{name:"tableId",value:"2"}];var o=[{name:"tableId",operator:"=",value:"1"}];DbMethods.updateData(i,j,m,o,function(r,s){alert("updated");l(s,"1")},function(r){})}}else{var m=[{name:"tableId",value:"2"}];var o=[{name:"tableId",operator:"=",value:"1"}];DbMethods.updateData(i,j,m,o,function(r,s){l(s,"1")},function(r){})}break;case 2:case"2":if(q[0]["ORGID"]!=q[1]["ORGID"]){if(q[0]["ORGID"]===pwcProperties.ORGID){if(q[0]["app_id"]===pwcProperties.Id){g(j,"1")}else{var n=[{name:"tableId",operator:"=",value:"2"}];k(n,function(){var r=[{name:"tableId",value:"2"}];var s=[{name:"tableId",operator:"=",value:"1"}];DbMethods.updateData(i,j,r,s,function(t,u){},function(){l(j,"1")},function(){})},function(){})}}else{if(q[1]["ORGID"]===pwcProperties.ORGID){if(q[1]["app_id"]===pwcProperties.Id){var m=[{name:"tableId",value:"2"}];var o=[{name:"tableId",operator:"=",value:"1"}];DbMethods.updateData(PlatwareDb.DbObj,j,m,o,function(r,s){var t=[{name:"tableId",value:"1"}];var u=[{name:"tableId",operator:"=",value:"2"},{name:"ORGID",operator:"=",value:pwcProperties.ORGID},{name:"app_id",operator:"=",value:pwcProperties.Id}];k(u,function(){l(s,"1")},function(){})},function(r){})}else{var n=[{name:"tableId",operator:"=",value:"2"}];k(n,function(){var r=[{name:"tableId",value:"2"}];var s=[{name:"tableId",operator:"=",value:"1"}];DbMethods.updateData(PlatwareDb.DbObj,j,r,s,function(t,u){l(u,"1")},function(){})},function(){})}}else{var n=[{name:"tableId",operator:"=",value:"2"}];k(n,function(){var r=[{name:"tableId",value:"2"}];var s=[{name:"tableId",operator:"=",value:"1"}];DbMethods.updateData(PlatwareDb.DbObj,j,r,s,function(t,u){l(u,"1")},function(){})},function(){})}}}else{if(q[0]["ORGID"]===pwcProperties.ORGID){if(q[0]["app_id"]!=q[1]["app_id"]){if(q[0]["app_id"]===pwcProperties.Id){g(j,"1")}else{if(q[1]["app_id"]===pwcProperties.Id){var m=[{name:"tableId",value:"2"}];var o=[{name:"tableId",operator:"=",value:"1"}];DbMethods.updateData(PlatwareDb.DbObj,j,m,o,function(r,s){var t=[{name:"tableId",operator:"=",value:"2"},{name:"ORGID",operator:"=",value:pwcProperties.ORGID},{name:"app_id",operator:"=",value:pwcProperties.Id}];k(t,function(){l(s,"1")},function(){})},function(){})}else{var o=[{name:"tableId",operator:"=",value:"2"},];k(o,function(){var r=[{name:"tableId",value:"2"}];var s=[{name:"tableId",operator:"=",value:"1"}];DbMethods.updateData(PlatwareDb.DbObj,j,r,s,function(t,u){l(u,"1")})},function(){})}}}}else{var n=[{name:"ORGID",operator:"=",value:orgId},{name:"tableId",operator:"=",value:"2"}];k(n,function(){var r=[{name:"tableId",value:"2"}];var s=[{name:"tableId",operator:"=",value:"1"}];DbMethods.updateData(PlatwareDb.DbObj,j,r,s,function(t,u){l(u,"1")})},function(){})}}break;default:if(q[0]["ORGID"]===pwcProperties.ORGID){if(q[0]["app_id"]===pwcProperties.Id){var n=[{name:"tableId",operator:"=",value:"1"}];k(n,function(){l(j,"1")},function(){})}else{var n=[{name:"tableId",operator:"=",value:"2"}];k(n,function(){var r=[{name:"tableId",value:"2"}];var s=[{name:"tableId",operator:"=",value:"1"}];DbMethods.updateData(i,j,r,s,function(t,u){l(u,"1")},function(){})},function(){})}}else{if(q[p-1]["ORGID"]===pwcProperties.ORGID){if(q[p-1]["app_id"]===pwcProperties.Id){var n=[{name:"tableId",operator:"=",value:"2"}];k(n,function(){var r=[{name:"tableId",value:"2"}];var s=[{name:"tableId",operator:"=",value:"1"}];DbMethods.updateData(i,j,r,s,function(t,u){l(u,"1")},function(){})},function(){})}else{var n=[{name:"tableId",operator:"=",value:"2"}];k(n,function(){var r=[{name:"tableId",value:"2"}];var s=[{name:"tableId",operator:"=",value:"1"}];DbMethods.updateData(i,j,r,s,function(t,u){l(u,"1")},function(){})},function(){})}}else{var n=[{name:"tableId",operator:"=",value:"2"}];k(n,function(){var r=[{name:"tableId",value:"2"}];var s=[{name:"tableId",operator:"=",value:"1"}];DbMethods.updateData(i,j,r,s,function(t,u){l(u,"1")},function(){})},function(){})}}}},function(){})},function(){var m=[{name:"tableId",datatype:"integer"},{name:"ORGID",datatype:"text"},{name:"app_id",datatype:"text"}];for(var n=0;n<c.length;n++){if((c[n].toLowerCase()!="org_id")&&(c[n].toLowerCase()!="app_id")){var o={name:c[n],datatype:"text"};m.push(o)}}DbMethods.createTable(i,j,m,function(p,q){l(q,"1")},function(){},"",h)});function l(n,s){console.log("Inserting "+n+" data");var m=[];for(var o=0;o<b.length;o++){var t=[{name:"tableId",value:s},{name:"ORGID",value:pwcProperties.ORGID},{name:"app_id",value:pwcProperties.Id}];var r=t;for(var q=0;q<c.length;q++){if((c[q].toLowerCase()!="org_id")&&(c[q].toLowerCase()!="app_id")){var p={name:c[q],value:b[o][c[q]]};r.push(p)}}m.push(r)}DbMethods.insertData(PlatwareDb.DbObj,n,m,function(u,v){d()},function(v,u){f()})}function g(m,q){console.log("updating data : orgDataChecker");var p=[{name:"ORGID",operator:"=",value:pwcProperties.ORGID},{name:"app_id",operator:"=",value:pwcProperties.Id}];var r=[{name:"tableId",value:q},{name:"ORGID",value:pwcProperties.ORGID},{name:"app_id",value:pwcProperties.Id}];for(var o=0;o<c.length;o++){if((c[o].toLowerCase()!="org_id")&&(c[o].toLowerCase()!="app_id")){var n={name:c[o],value:b[0][c[o]]};r.push(n)}}DbMethods.updateData(PlatwareDb.DbObj,m,r,p,function(s){console.log(JSON.stringify(s));d()},function(){f()})}function k(m,o,n){DbMethods.deleteData(i,j,m,o,n)}}else{d()}},checkParamCount:function(g,f,b,d){var a=PlatwareDb.DbObj;var e=0;var c=0;DbMethods.readData(a,g,["*"],[],[],function(k,j){for(var h=0;h<k.length;h++){e+=parseInt(k[h]["parameter_count"])}if(k.length>0){if(e>0){DbMethods.readData(a,f,["*"],[],[],function(l,i){c=l.length;if(e===c){b()}else{d()}},d)}else{b()}}else{d()}},d)},getDeviceInfo:function(){var c={platform:"",model:"",make:"",osVersion:"",};var b;try{if(device){b="mobile"}else{b="PC"}}catch(a){b="PC"}console.log(b);switch(b){case"mobile":(device.platform).toUpperCase()==="IPAD"?c="IPHONE":c=(device.platform).toUpperCase();c.model=device.model;c.osVersion=device.version;break;case"PC":if(navigator.platform.toLowerCase().indexOf("win")>=0&&navigator.platform.toLowerCase().indexOf("mac")<0&&navigator.platform.toLowerCase().indexOf("linux")<0&&navigator.platform.toLowerCase().indexOf("unix")<0){c.platform="windows";c.osVersion=navigator.userAgent.toLowerCase().substr(navigator.userAgent.toLowerCase().indexOf("win")+7,7)}else{if(navigator.platform.toLowerCase().indexOf("win")<0&&navigator.platform.toLowerCase().indexOf("mac")>=0&&navigator.platform.toLowerCase().indexOf("linux")<0&&navigator.platform.toLowerCase().indexOf("unix")<0){c.platform="mac";c.osVersion=navigator.userAgent.toLowerCase().substr(navigator.userAgent.toLowerCase().indexOf("mac os x")+8,6)}else{if(navigator.platform.toLowerCase().indexOf("win")<0&&navigator.platform.toLowerCase().indexOf("mac")<0&&navigator.platform.toLowerCase().indexOf("linux")>=0&&navigator.platform.toLowerCase().indexOf("unix")<0){c.platform="linux";c.osVersion=navigator.userAgent.toLowerCase()}else{if(navigator.platform.toLowerCase().indexOf("win")<0&&navigator.platform.toLowerCase().indexOf("mac")<0&&navigator.platform.toLowerCase().indexOf("linux")<0&&navigator.platform.toLowerCase().indexOf("unix")>=0){c.platform="unix";c.osVersion=navigator.userAgent.toLowerCase()}else{c.platform=navigator.platform}}}}if(navigator.userAgent.toLowerCase().indexOf("trident")>0){c.make="IE";c.model=navigator.userAgent.substr(navigator.userAgent.toLowerCase().indexOf("trident")+8,2)}else{if(navigator.userAgent.toLowerCase().indexOf("firefox")>0){c.make="Firefox";c.model=navigator.userAgent.substr(navigator.userAgent.toLowerCase().indexOf("firefox")+8,2)}else{if(navigator.userAgent.toLowerCase().indexOf("chrome")>0){c.make="Chrome";c.model=navigator.userAgent.substr(navigator.userAgent.toLowerCase().indexOf("chrome")+7,2)}else{if(navigator.userAgent.toLowerCase().indexOf("safari")>0&&navigator.userAgent.toLowerCase().indexOf("chrome")<0){c.make="Safari";c.model=navigator.userAgent.substr(navigator.userAgent.toLowerCase().indexOf("safari")+7,2)}else{if(navigator.userAgent.toLowerCase().indexOf("opera")>0&&navigator.userAgent.toLowerCase().indexOf("presto")>0){c.make="opera";c.model=navigator.userAgent.substr(navigator.userAgent.toLowerCase().indexOf("opera")+7,2)||navigator.userAgent.substr(navigator.userAgent.toLowerCase().indexOf("presto")+7,2)}else{c.make=navigator.userAgent;c.model=navigator.userAgent}}}}}break;default:}return c}};