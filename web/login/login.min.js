var loginModule=angular.module("MDM.login",["ngRoute","ngMessages"]);loginModule.controller("loginCtrl",["$scope","$location","LoginCredsFactory","PlatwareRequest","parsePlatwareResponse","dmDialogueBox","sessionDetails","sessionIdService",function(j,e,g,a,c,d,f,i){j.hideLoader();j.killAllSessionAndLogin=function(){var k=[{processName:"PWKILLALLSESSION",data:[]}];a.callPlatware(k).success(function(l){}).error(function(){})};var h=function(){var m=j.mdmUsername;var k=j.mdmPassword;var l=[{processName:"PWAUTH",data:[]}];a.callPlatware(l).success(function(n){var p=c.parse(n);j.hideLoader();for(var o=0;o<p.length;o++){if(p[o].isError=="N"){if(p[o].processName=="PWAUTH"){j.loginData=p[o].data[0]["is_auth"];var r=JSON.parse(p[o].data[0]["auth_data"]);if(j.loginData=="Y"){var s=p[o].data[0]["session_expire_time_in_min"]||"20";f.setDetails(s);var q=p[o].data[0]["user_session_id"];i.setUserSessionId(q);e.path("/mainpage2")}else{d.alertBox({title:"Invalid Login",message:r.message,actionlabel:["Ok"]}).then(function(t){})}}}else{if(p[o].errorCode==="MSESSION"){d.confirmBox({title:"Session Warning",message:"User already logged in, Do want to kill previous session and proceed ?",actionlabel:["No","Yes"]}).then(function(t){if(t){j.showLoader();j.killAllSessionAndLogin();h()}})}else{if(p[o].errorCode==="MAXSESSION"){d.confirmBox({title:"Session Warning",message:"Maximum logged in users limit reached, Do want to kill all previous session and proceed?",actionlabel:["No","Yes"]}).then(function(t){if(t){j.killAllSessionAndLogin();h()}})}else{d.alertBox({title:"Login Error!",message:"Authentication Failed",actionlabel:["Ok"]}).then(function(t){})}}}}}).error(function(n){g.clearLoginCreds();d.alertBox({title:"Server Error",message:"Server not responding",actionlabel:["Ok"]}).then(function(o){});j.hideLoader()})};var b=function(){var k=[{processName:"ADAUTH",data:[]}];a.callPlatware(k).success(function(n){var m=n.data;var l=m.split("~");j.adAuthFlag=l[0];g.setAdflag(j.adAuthFlag);h()}).error(function(l){j.hideLoader();d.alertBox({title:"Oops!!",message:"Some error occured..Please try again..!!",actionlabel:["Ok"],iconType:"error"}).then(function(m){})})};j.validateLogin=function(){if(!j.mdmUsername||!j.mdmPassword){d.alertBox({title:"Invalid Login",message:"Please Enter Username and Password",actionlabel:["Ok"]}).then(function(n){});return}j.showLoader("validating User");var m=j.mdmUsername;var k=j.mdmPassword;if(m){if(k){var l=sha256(k);g.setLoginCreds(m,k);g.setDecryptedPw(k);h()}}else{alert("enter username")}}}]);