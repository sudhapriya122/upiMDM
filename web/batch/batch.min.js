var batchModule=angular.module("MDM.batch",["ngRoute","ngMessages"]);batchModule.controller("batchCtrl",["$scope","$location","$routeParams","LoginCredsFactory","PlatwareRequest","parsePlatwareResponse","dmDialogueBox","entityListService","orgIdService","$filter",function(k,e,i,f,a,c,d,j,h,g){k.curEntityId="";k.entityList="";k.batchDataTable=false;k.currentBatchTable=false;var b=i.entityid;k.curEntityId=b;k.getEntitylist=function(){var l=h.getOrgId();var m=[{processName:"SPENTITYLIST",data:[{x_org_id:l.orgid}]}];a.callPlatware(m).success(function(n){var p=c.parse(n);for(var o=0;o<p.length;o++){if(p[o].isError=="N"){if(p[o].processName=="SPENTITYLIST"){k.entityList=p[o].data;k.selectedEntity=g("byProp")(k.entityList,"entityid",k.curEntityId);k.entityName=k.selectedEntity[0].entitydescription}}else{d.alertBox({title:"Server Error",message:"response error",actionlabel:["Ok"]}).then(function(q){})}}}).error(function(){k.serverError()})};k.getBatch=function(){var l=[{processName:"GETBATCHLIST",data:[{x_entityid:k.curEntityId}]}];k.showLoader("Getting Batch Data");a.callPlatware(l).success(function(n){var p=c.parse(n);k.batchData=p;k.hideLoader();for(var o=0,m=p.length;o<m;o++){if(p[o]["isError"]=="N"){k.batchData=p[o]["data"];k.batchDataTable=true;k.currentBatchTable=false}else{d.alertBox({title:"Alert",message:"Error From Server Side",actionlabel:["Ok"]}).then(function(q){})}}}).error(function(){k.hideLoader();k.serverError()})};k.dmTableAction=[{column_name:"view_btn",action_function:"tableAction"}];k.tableAction=function(n){var m=n;var l=m["batch id"];if(l.length<=0){d.alertBox({title:"Alert",message:"Batch Id cannot be blank",actionlabel:["Ok"]}).then(function(o){})}else{e.path("/batchData/"+l+"/"+k.curEntityId)}};k.refreshBatchData=function(){k.getBatch()};k.submitRecords=function(o){var n=[];var m="";for(var l=0;l<o.length;l++){n.push(o[l]["batch id"])}if(n.length>0){m=n.join("~");var o=[{processName:"INSERTINTOMASTER",data:[{x_entityid:k.curEntityId,x_batch_id:m}]}];k.showLoader("Moving Data To Master");a.callPlatware(o).success(function(p){var t=c.parse(p);k.hideLoader();for(var q=0;q<t.length;q++){if(t[q].isError=="N"){if(t[q].processName=="INSERTINTOMASTER"){var s=t[q].data[0]["message"];var r="";if(t[q].data[0]["info"]&&t[q].data[0]["info"].length>0){r=t[q].data[0]["info"]}else{r="Data has been moved to master successfully"}if(s.toLowerCase()=="success"){d.alertBox({title:"Proceed",message:r,actionlabel:[]}).then(function(u){e.path("/mainpage2")});k.showScreenControls.optsClass="slide-down"}else{d.alertBox({title:"Proceed",message:"Some error occured while moving to master",actionlabel:[]}).then(function(u){})}}}else{d.alertBox({title:"Proceed",message:"Some error occured while moving to master",actionlabel:[]}).then(function(u){})}}}).error(function(){k.hideLoader();k.serverError()})}else{d.alertBox({title:"Alert",message:"Select batch id(s) to be moved to master.",actionlabel:[]}).then(function(p){})}};k.$on("sessionValidateEvent",function(n,l){if(l){try{var m=g("byProp")(k.path.fullPath,"action","batch");if(m.length<=0){k.action={};k.action.name="Batch List";k.action.action="batch";k.setPath(k.action)}else{k.path.fullPath.pop()}if(b.length<=0){k.showEntityList=true;k.entityList=j.getEntityList()}else{k.showEntityList=false;k.getEntitylist();k.getBatch()}}catch(n){}}else{d.alertBox({title:"Error",message:"Invalid user or session, kindly login again",actionlabel:["Ok"]}).then(function(o){e.path("/login")})}})}]);