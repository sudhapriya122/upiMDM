"use strict";var appModule=angular.module("MDM",["ngRoute","RouteData","dmCommonApiModule","MDM.version","MDM.login","MDM.batch","MDM.mainpage2","MDM.batchData"]);appModule.config(["$routeProvider","RouteDataProvider",function(b,a){var c=window.innerHeight;c=c-((3/100)*c);a.applyConfig({bodyStyle:{"background-color":"white"},loaderColor:{color:"#ec6726"},sectionStyle:{}});b.when("/login",{RouteData:{bodyStyle:{background:"#ec6726",hieght:"auto"}},title:"MDM :: Login",templateUrl:"login/login.html"}).when("/mainpage2",{RouteData:{bodyStyle:{background:"#ffffff",height:c+"px"},sectionStyle:{padding:"3% 0 0 0",height:"40%"}},title:"MDM :: Home",templateUrl:"mainpage2/mainpage.html"}).when("/batch/:entityid",{RouteData:{bodyStyle:{background:"#ffffff",height:c+"px"},sectionStyle:{padding:"3% 0 0 0",height:"40%"}},title:"MDM :: Home",templateUrl:"batch/batch.html"}).when("/batchData/:batchid/:entityid",{RouteData:{bodyStyle:{background:"#ffffff",height:c+"px"},sectionStyle:{padding:"3% 0 0 0",height:"40%"}},title:"MDM :: Home",templateUrl:"uploadedBatch/uploadedBatch.html"});b.otherwise({redirectTo:"/login"})}]);appModule.service("sessionDetails",[function(){var a={};return{getDetails:function(){return a},setDetails:function(c){var b="";if(c&&c.length>0){b=c}else{b="20"}a.timeout=parseInt(b)}}}]);appModule.run(["$rootScope","$route","$location","$http","dmDialogueBox","LoginCredsFactory","sessionDetails",function(c,h,g,f,d,b,a){c.$on("$routeChangeSuccess",function(i,j){document.title=j.$$route.title});String.prototype.hexEncode=function(){var l,k;var j="";for(k=0;k<this.length;k++){l=this.charCodeAt(k).toString(16);j+=("000"+l).slice(-4)}return j};String.prototype.hexDecode=function(){var k;var l=this.match(/.{1,4}/g)||[];var i="";for(k=0;k<l.length;k++){i+=String.fromCharCode(parseInt(l[k],16))}return i};var e=new Date().getTime();c.keys=Object.keys;c.$watch(function(){var k=a.getDetails();var i=k.timeout;var j=new Date().getTime();if(j-e>i*60000){if(g.path()!=="/login"){d.alertBox({title:"Session Error!",message:"Session expired",actionlabel:["Ok"]}).then(function(l){if(b.getSSO()){window.close()}else{g.path("/login")}})}}e=j})}]);appModule.directive("appheader",function(){return{restrict:"E",templateUrl:"templates/appHeader/headertemplate.html",scope:{username:"=dmUsername"},link:function(c,b,a){c.appName=a.appname},controller:["$scope","LoginCredsFactory","$location","PlatwareRequest","dmDialogueBox","$timeout","$rootScope",function(e,c,h,b,g,f,a){var d=c.getLoginCreds();e.showLoader=function(i){e.showMDMLoader=true;e.loadingMessage=i||"Loading..."};e.hideLoader=function(){e.showMDMLoader=false};if(d){e.username=d.userId||""}else{e.username=""}e.logout=function(i){switch(i){case"logout":g.confirmBox({title:"Confirm",message:"Do you want to logout?",actionlabel:["No","Yes"]}).then(function(k){if(k){e.showLoader();var j=[{processName:"PWKILLALLSESSION",data:[]}];b.callPlatware(j).success(function(){f(function(){h.path("/login");c.clearLoginCreds()},3000)}).error(function(){e.hideLoader()})}});break}};e.gotoHome=function(){var i=window.location.href;if(i.indexOf("mainpage2")>-1){e.$parent.removePath(0);e.$parent.reset()}else{e.$parent.removePath(0);e.$parent.reset();h.path("/mainpage2")}}}]}});appModule.factory("LoginCredsFactory",function(){var f,d,b;var a="storagesecretkey";var c={};var e={};var g={};return{setLoginCreds:function(i,h){f=i;d=h;c.userId=i;c.password=h;cryptor.encrypt(i,a,function(j){sessionStorage.setItem("MDM_userId",j)})},setDecryptedPw:function(h){e.pwrd=h},getDecryptedPw:function(){return e},setAdflag:function(h){g.adFlag=h},getAdflag:function(){return g},getLoginCreds:function(){var k=this.getSSO();if(k){c.password="";if(c.userId){c.password="";return c}else{if(sessionStorage.MDM_userId&&sessionStorage.MDM_userId.length>0){var i=false;var j=null;var h=null;cryptor.decrypt(sessionStorage.MDM_userId,a,function(l){j=l});while(!i){if(j){i=true}}c.userId=j;return c}}}else{if(c.userId&&c.password){return c}else{if(sessionStorage.MDM_userId&&sessionStorage.MDM_userId.length>0){var i=false;var j=null;var h=null;cryptor.decrypt(sessionStorage.MDM_userId,a,function(l){j=l});if(sessionStorage.MDM_password&&sessionStorage.MDM_password.length>0){cryptor.decrypt(sessionStorage.MDM_password,a,function(l){h=l})}else{h=""}while(!i){if(j&&(h||h=="")){i=true}}c.userId=j;c.password=h;return c}else{c.userId="";c.password="";return c}}}},getSessionLoginId:function(){var h=false;var i=null;if(sessionStorage.MDM_userId){cryptor.decrypt(sessionStorage.MDM_userId,a,function(j){i=j})}else{i=""}while(!h){if(i==null){}else{h=true}}return i},setLoginId:function(h){pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWHEADER.LOGIN_ID=h;c.userId=h;if(h!=""){cryptor.encrypt(h,a,function(i){sessionStorage.setItem("MDM_userId",i)})}},clearLoginCreds:function(){d="";f="";c={};sessionStorage.clear()},setSSO:function(h){sessionStorage.setItem("ssoStatus",h)},getSSO:function(){if(sessionStorage.ssoStatus){b=sessionStorage.getItem("ssoStatus")}return b}}});appModule.factory("validateFileData",["$q",function(a){var e;var d=null;var c=[];var b={messageCount:1};return{setWorkConfiguration:function(g){b=g;var f=parseInt(b.messageCount);e.onmessage=function(h){c.push(h.data);if(f===1){d.resolve(c)}if(c.length===f){d.resolve(c)}if(c.length==1&&c[0].message!=""){d.resolve(c)}}},doWork:function(f,g){b={messageCount:1};e=new Worker("doFileDataValidate.js");c=[];if(g){this.setWorkConfiguration(g)}else{this.setWorkConfiguration(b)}d=a.defer();e.postMessage(f);return d.promise},submitData:function(f,g){b={messageCount:1};e=new Worker("doFileDataSubmit.js");c=[];if(g){this.setWorkConfiguration(g)}else{this.setWorkConfiguration(b)}d=a.defer();e.postMessage(f);return d.promise},readFileData:function(f){b={messageCount:1};c=[];e=new Worker("readFileNew.js");this.setWorkConfiguration(b);d=a.defer();e.postMessage(f);return d.promise},downloadFileData:function(f){b={messageCount:1};c=[];e=new Worker("downloadFile.js");this.setWorkConfiguration(b);d=a.defer();e.postMessage(f);return d.promise}}}]);appModule.controller("headerCtrl",function(){});appModule.controller("mdm_init",["$scope","$filter","$location","dmDialogueBox","LoginCredsFactory","sessionIdService","$rootScope","$routeParams",function(c,f,h,d,b,g,a,e){c.path={};c.getPath=[];c.actionName={};c.path.fullPath=[];c.showScreenControls={};c.OrgNames={};c.userName="";c.showMDMLoader=false;c.sessionVars={isSessionValid:false,isSSO:false};c.setInitSSO=function(k){b.setSSO(c.sessionVars.isSSO);k=k[1];k=k.split("&");var m={};for(var l=0,j=k.length;l<j;l++){var n=k[l].split("=");m[n[0]]=n[1]}if(m.userId&&m.userId.length>0){b.setLoginCreds(m.userId,"tempPassword");c.sessionVars.isSessionValid=true}if(m.SId&&m.SId.length>0){c.sessionVars.isSessionValid=true;g.setUserSessionId(m.SId)}else{d.alertBox({title:"Session Error",message:"Invalid User Session"});h.path("/login");return}c.$broadcast("sessionValidateEvent",c.sessionVars.isSessionValid)};c.resetSSO=function(){var i=b.getSSO();if(i&&i.length>0){c.sessionVars.isSSO=true;c.sessionVars.isSessionValid=true;c.$broadcast("sessionValidateEvent",c.sessionVars.isSessionValid)}else{c.initWithoutSSO()}};c.initWithoutSSO=function(){var i=b.getLoginCreds()||{};if(i.userId&&i.userId.length>0){c.sessionVars.isSessionValid=true;c.$broadcast("sessionValidateEvent",c.sessionVars.isSessionValid)}else{d.alertBox({title:"Session Error",message:"Invalid User Session"});h.path("/login");return}};c.checkSession=function(){c.sessionVars.isSessionValid=false;c.sessionVars.isSSO=false;var k=window.location.href;var j="";if(k.indexOf("?")>-1){var i=k.split("?");window.location.href=i[0];if(i[1]&&i[1].length>0){c.sessionVars.isSSO=true;c.setInitSSO(i)}}else{c.resetSSO()}};c.setPath=function(j){var i=f("byProp")(c.path.fullPath,"action",j.action);if(i.length<=0){c.path.fullPath.push(j)}else{c.path.fullPath.pop();c.path.fullPath.push(j)}c.getPath=c.path.fullPath};c.pathAction=function(j,i,k){switch(j){case"org":if(c.OrgNames.OrgList.length==1){try{k.defaultPrevented=true}catch(l){}}else{c.showScreenControls.showProceedAction=false;c.showScreenControls.showOrgOptions=true;c.showScreenControls.showStaging=false;c.showScreenControls.showStagingTable=false;c.showScreenControls.showMaster=false;c.showScreenControls.showMasterTable=false;c.showScreenControls.showRejectedTable=false;c.showScreenControls.showTable=false;c.showScreenControls.showSlideUpIcon=false;c.showScreenControls.showBatchId=false;c.showScreenControls.showFileUploadResult=false;c.showScreenControls.showfileUpload=false;c.showScreenControls.showRejected=false;c.showScreenControls.showcreateMapping=false;c.showScreenControls.showchangeMapping=false;c.removePath(i);c.showScreenControls.orgItem=""}break;case"action":c.showScreenControls.optsClass="slide-down";if(window.location.href.indexOf("mainpage2")>-1){c.reset()}else{h.path("/mainpage2")}c.removePath(i);break;case"entity":c.showScreenControls.optsClass="slide-down";c.removePath(i);if(window.location.href.indexOf("mainpage2")>-1){c.editEntity()}else{h.path("/mainpage2")}break;case"batchData":var m=e.entityid;c.showScreenControls.optsClass="slide-down";c.removePath(i);h.path("/batch/"+m);break;case"batch":c.showScreenControls.optsClass="slide-down";c.removePath(i);h.path("/mainpage2");break}document.getElementById("fileName").innerHTML="";document.getElementById("createFileName").innerHTML="";document.getElementById("changeFileName").innerHTML="";document.getElementById("UploadFileInput").value="";c.showScreenControls.sheetsObj={}};c.editEntity=function(){c.showScreenControls.showTemplateOption=false;c.showScreenControls.showFileUploadResult=false;c.showScreenControls.showfileUpload=false;c.showScreenControls.showTable=false;c.showScreenControls.showSlideUpIcon=false;c.showScreenControls.showRejected=false;c.showScreenControls.showFileUploadButton=false;c.showScreenControls.createMappingSection=false;c.showScreenControls.showcreateMapping=false;c.showScreenControls.showSubmitButton=false;c.showScreenControls.showchangeMapping=false;c.showScreenControls.showStagingTable=false;c.showScreenControls.showMasterTable=false;c.showScreenControls.showRejectedTable=false;c.showScreenControls.proceedEntity=true;c.showScreenControls.showBatchId=false};c.reset=function(){c.showScreenControls.optsClass==="slide-up"?c.showScreenControls.optsClass="slide-down":"";c.showScreenControls.proceedEntity=false;c.showScreenControls.showStagingTable=false;c.showScreenControls.showMasterTable=false;c.showScreenControls.showRejectedTable=false;c.showScreenControls.showcreateMapping=false;c.showScreenControls.showTemplateOption=false;c.showScreenControls.showProceedAction=true;c.showScreenControls.showProceedButtons=true;c.showScreenControls.showchangeMapping=false;c.showScreenControls.showfileUpload=false;c.showScreenControls.showTable=false;c.showScreenControls.showRejected=false;c.showScreenControls.showFileUploadButton=false;c.showScreenControls.showSubmitButton=false;c.showScreenControls.showFileUploadResult=false;c.showScreenControls.showSlideUpIcon=false;c.showScreenControls.showBatchId=false;c.showScreenControls.showStaging=false;c.showScreenControls.showMaster=false;c.showScreenControls.createMappingSection=false;c.showScreenControls.headers=[]};c.removePath=function(i){var j=c.path.fullPath.length;c.path.fullPath.splice(i,j)};c.serverError=function(){d.alertBox({title:"Server Error",message:"Server Not Responding",actionlabel:["Ok"]}).then(function(i){})};c.showLoader=function(i){c.showMDMLoader=true;c.loadingMessage=i||"Loading..."};c.hideLoader=function(){c.showMDMLoader=false}}]);appModule.service("batchDataService",["LoginCredsFactory",function(a){var b="";return{getBatchId:function(){var e=new Date();var g=e.getTime();var d=a.getLoginCreds();var f=d.userId;var c=f+g;b=c;return b}}}]);appModule.service("entityListService",["LoginCredsFactory",function(a){var b={};return{getEntityList:function(){return b},setEntityList:function(c){b=c}}}]);appModule.service("orgIdService",[function(){var a;return{getOrgId:function(){a=JSON.parse(sessionStorage.getItem("orgId"));return a},setOrgId:function(b){sessionStorage.setItem("orgId",b)}}}]);appModule.service("batchDataService",["LoginCredsFactory",function(a){var b="";return{getBatchId:function(){var e=new Date();var g=e.getTime();var d=a.getLoginCreds();var f=d.userId;var c=f+g;b=c;return b}}}]);appModule.service("sessionIdService",function(){var a="";return{getUserSessionId:function(){if(a.length<=0){if(sessionStorage.MDMUserSessionID){this.setUserSessionId(sessionStorage.MDMUserSessionID)}else{a=""}}return a},setUserSessionId:function(b){sessionStorage.setItem("MDMUserSessionID",b);a=b}}});appModule.service("PlatwareRequest",["$http","LoginCredsFactory","sessionIdService","dmDialogueBox",function(d,a,c,b){this.callPlatware=function(j){var i=c.getUserSessionId();var m=new Fingerprint();var f=null;var k=null;var r=a.getSessionLoginId();a.setLoginId(r);var q=a.getDecryptedPw();var l=a.getAdflag();pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWHEADER.PW_VERSION="LMS";pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWHEADER.IMEI_NO=m.get()+"";function p(v){var u="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";var s="";for(var t=v;t>0;--t){s+=u[Math.round(Math.random()*(u.length-1))]}return s}var e=p(16);var o=null;if(pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWHEADER.LOGIN_ID===""){if(r){}else{b.alertBox({title:"Session Error!",message:"invalid user session, Login again!",actionlabel:["Ok"]}).then(function(s){console.log(s)});return}}var h=false;var g=a.getLoginCreds();if(g.userId!==""){pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWHEADER.LOGIN_ID=cryptor.encryptText(g.userId,e);pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWHEADER.USER_ID=cryptor.encryptText(g.userId,e)}else{pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWHEADER.LOGIN_ID="";pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWHEADER.USER_ID=""}if(j[0].processName=="PWAUTH"){pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWHEADER.PW_CLIENT_VERSION=l.adFlag}else{pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWHEADER.PW_CLIENT_VERSION=""}if(g.password&&g.password!==""){if(j[0].processName=="ADAUTH"){pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWHEADER.PASSWORD=cryptor.encryptText(q.pwrd,e)}else{pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWHEADER.PASSWORD=cryptor.encryptText(g.password,e)}}else{pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWHEADER.PASSWORD=""}pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWHEADER.PW_SESSION_ID=cryptor.encryptText(e,"decimalsecretkey");if(i){pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWHEADER.USER_SESSION_ID=cryptor.encryptText(i,e)}else{pwcProperties.platwareRequest.PWSESSIONRS.PWPROCESSRS.PWHEADER.USER_SESSION_ID=""}var o=PWCutilities.createDataJSON(j);var n={method:"POST",url:pwcProperties.URL,headers:{"Content-Type":"text/plain"},data:JSON.parse(o),timeout:180000};return d(n);console.log(o);return d(n).success(function(s){console.log("hi")}).error(function(s){return s})}}]);appModule.service("parsePlatwareResponse",["sessionIdService","$location","dmDialogueBox","LoginCredsFactory",function(e,d,c,a){function b(){if(a.getSSO()){d.path("/login")}else{d.path("/login")}return}return{parse:function(k){var l=k.PWSESSIONRS;var h=[];for(var m=0,p=l.length;m<p;m++){var j=e.getUserSessionId();e.setUserSessionId(j);var f=l[m].PWPROCESSRS.PWHEADER.IN_PROCESS_ID;var g={data:"",isError:"",processName:"",errorCode:""};if(l[m].PWPROCESSRS.PWERROR===""){g.isError="N";g.data=l[m].PWPROCESSRS.PWDATA[f]["Row"];g.processName=f.toUpperCase()}else{g.isError="Y";g.processName=f.toUpperCase();try{var q=l[m].PWPROCESSRS.PWERROR[f]["Row"]["MsgID"].toUpperCase();g.errorCode=q;var n=l[m].PWPROCESSRS.PWERROR[f]["Row"]["Message"];if(q==="MSESSION"||q==="MAXSESSION"){g.errorCode=q;if(g.processName!=="PWAUTH"){c.alertBox({title:"Session Error!",message:n,actionlabel:["Ok"]}).then(function(i){b()});m=p;break}}else{if(q==="ESESSION"||q==="SESSIONID"){c.alertBox({title:"Session Error!",message:n,actionlabel:["Ok"]}).then(function(i){b()});m=p;break}}}catch(o){}}h.push(g)}return h}}}]);